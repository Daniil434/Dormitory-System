<UserControl x:Class="Dormitory_System.Views.KomendantView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Dormitory_System.Views"
             xmlns:vm="clr-namespace:Dormitory_System.ViewModels"
             xmlns:models="clr-namespace:Dormitory_System.Entities"
             xmlns:converters="clr-namespace:Dormitory_System.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid>
        <!-- Заголовок -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="LightBlue" Margin="0,0,0,10">
            <TextBlock Text="Комендант: Панель управления" FontSize="16" FontWeight="Bold" Margin="10,5,20,5"/>
            <TextBlock Text="{Binding CurrentUser.Username}" FontSize="14" Margin="0,0,20,0"/>
            <Button Content="Выход" Command="{Binding LogoutCommand}" Width="80" Height="25" Margin="10,0,0,0"/>
        </StackPanel>

        <!-- Основная область (Вкладки) -->
        <TabControl Grid.Row="1">
            <!-- Вкладка "Управление блоками" -->
            <TabItem Header="Управление блоками">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Панель управления блоками -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
                        <TextBlock Text="Название блока: " VerticalAlignment="Center" Margin="0,5,10,5"/>
                        <TextBox x:Name="NewBlockName" Width="200" Margin="0,5,10,5"
                                 Text="{Binding NewBlockName, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Content="Добавить блок" Command="{Binding AddBlockCommand}" Margin="0,5,0,5"/>
                    </StackPanel>

                    <!-- Таблица блоков -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding Blocks}" AutoGenerateColumns="False" 
                              IsReadOnly="True" Margin="10" AlternatingRowBackground="LightGray">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding BlockId}" Width="Auto"/>
                            <DataGridTextColumn Header="Название" Binding="{Binding BlockName}" Width="*"/>
                            <DataGridTemplateColumn Header="Действия" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Удалить" Command="{Binding DataContext.DeleteBlockCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Margin="5,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Вкладка "Управление комнатами" -->
            <TabItem Header="Управление комнатами">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Панель управления комнатами -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
                        <TextBlock Text="Номер комнаты: " VerticalAlignment="Center" Margin="0,5,10,5"/>
                        <TextBox x:Name="NewRoomNumber" Width="100" Margin="0,5,10,5" Text="{Binding NewRoomNumber, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock Text="Блок: " VerticalAlignment="Center" Margin="0,5,10,5"/>
                        <ComboBox x:Name="NewRoomBlock" Width="150" Margin="0,5,10,5" ItemsSource="{Binding Blocks}" DisplayMemberPath="BlockName"
                                  SelectedItem="{Binding SelectedBlock}"/>
                        <TextBlock Text="Тип: " VerticalAlignment="Center" Margin="0,5,10,5"/>
                        <ComboBox x:Name="NewRoomType" Width="100" Margin="0,5,10,5" SelectedItem="{Binding NewRoomType}">
                            <ComboBoxItem Content="Single"/>
                            <ComboBoxItem Content="Double"/>
                            <ComboBoxItem Content="Triple"/>
                            <ComboBoxItem Content="Quad"/>
                        </ComboBox>
                        <Button Content="Добавить комнату" Command="{Binding AddRoomCommand}" Margin="0,5,0,5"/>
                    </StackPanel>

                    <!-- Таблица комнат -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding Rooms}" AutoGenerateColumns="False" 
                              IsReadOnly="True" Margin="10" AlternatingRowBackground="LightGray">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding RoomId}" Width="Auto"/>
                            <DataGridTextColumn Header="Номер" Binding="{Binding RoomNumber}" Width="100"/>
                            <DataGridTextColumn Header="Блок" Binding="{Binding Block.BlockName}" Width="100"/>
                            <DataGridTextColumn Header="Тип" Binding="{Binding RoomType}" Width="100"/>
                            <DataGridTextColumn Header="Вместимость" Binding="{Binding Capacity}" Width="100"/>
                            <DataGridTemplateColumn Header="Действия" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Удалить" Command="{Binding DataContext.DeleteRoomCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Margin="5,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Вкладка "Журнал заселения" -->
            <TabItem Header="Журнал заселения">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Панель фильтрации -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
                        <TextBlock Text="Студент: " VerticalAlignment="Center" Margin="0,5,10,5"/>
                        <ComboBox x:Name="StudentFilter" Width="200" Margin="0,5,10,5"
                                  ItemsSource="{Binding Students}" DisplayMemberPath="FullName"
                                  SelectedItem="{Binding SelectedStudent}"/>
                        <Button Content="Фильтр" Command="{Binding FilterSettlementCommand}" Margin="0,5,0,5"/>
                    </StackPanel>

                    <!-- Таблица заселения -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding Settlements}" AutoGenerateColumns="False" 
                              IsReadOnly="True" Margin="10" AlternatingRowBackground="LightGray">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding SettlementId}" Width="Auto"/>
                            <DataGridTextColumn Header="Студент" Binding="{Binding Student.FullName}" Width="*"/>
                            <DataGridTextColumn Header="Комната" Binding="{Binding Room.RoomNumber}" Width="100"/>
                            <DataGridTextColumn Header="Дата заселения" Binding="{Binding DateIn, StringFormat=d}" Width="120"/>
                            <DataGridTextColumn Header="Дата выселения" Binding="{Binding DateOut, StringFormat=d}" Width="120"/>
                            <DataGridTemplateColumn Header="Действия" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Выселить" Command="{Binding DataContext.CheckOutStudentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Margin="5,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Вкладка "Журнал нарушений" -->
            <TabItem Header="Журнал нарушений">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Панель добавления нарушения -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
                        <TextBlock Text="Студент: " VerticalAlignment="Center" Margin="0,5,10,5"/>
                        <ComboBox x:Name="NewViolationStudent" Width="200" Margin="0,5,10,5"
                                  ItemsSource="{Binding Students}" DisplayMemberPath="FullName"
                                  SelectedItem="{Binding SelectedStudent}"/>
                        <TextBlock Text="Тип нарушения: " VerticalAlignment="Center" Margin="0,5,10,5"/>
                        <TextBox x:Name="NewViolationType" Width="150" Margin="0,5,10,5"
                                 Text="{Binding NewViolationType, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Content="Добавить нарушение" Command="{Binding AddViolationCommand}" Margin="0,5,0,5"/>
                    </StackPanel>

                    <!-- Таблица нарушений -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding Violations}" AutoGenerateColumns="False" 
                              IsReadOnly="True" Margin="10" AlternatingRowBackground="LightGray">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding ViolationId}" Width="Auto"/>
                            <DataGridTextColumn Header="Студент" Binding="{Binding Student.FullName}" Width="*"/>
                            <DataGridTextColumn Header="Тип" Binding="{Binding ViolationType}" Width="150"/>
                            <DataGridTextColumn Header="Дата" Binding="{Binding ViolationDate, StringFormat=d}" Width="120"/>
                            <DataGridTextColumn Header="Действия" Binding="{Binding ActionTaken}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Нижняя панель (Статус) -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Background="LightGray" Margin="0,10,0,0">
            <TextBlock Text="Статус: Готово" FontSize="12" Margin="10,5,0,5"/>
            <TextBlock Text="{Binding StatusMessage}" FontSize="12" Margin="0,5,0,5"/>
        </StackPanel>
    </Grid>
</UserControl>
